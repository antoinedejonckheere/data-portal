<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Create a heatmap layer</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
 
<body>
    <div id="map"></div>

    <script>
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'https://api.maptiler.com/maps/7e7e2443-1c41-46d0-813c-f6b11c2c0225/style.json?key=2Piy1GKXoXq0rHzzBVDA',
            center: [4.3525, 50.8454],
            zoom: 14,
            hash: true
        });

        map.on('load', function () {

            // get lowest label and road.
            var style = map.getStyle();
            var lowestRoad = undefined;
            var lowestLabel = undefined;
            var lowestSymbol = undefined;
            for (var l = 0; l < style.layers.length; l++) {
                var layer = style.layers[l];

                if (layer && layer["source-layer"] === "transportation") {
                    if (!lowestRoad) {
                    lowestRoad = layer.id;
                    }
                }

                if (layer && layer["source-layer"] === "transportation_name") {
                    if (!lowestLabel) {
                    lowestLabel = layer.id;
                    }
                }

                if (layer && layer.type == "symbol") {
                    if (!lowestSymbol) {
                    lowestSymbol = layer.id;
                    }
                }
            }

            map.addSource("earthquakes", {
                type: 'vector',
                url: 'https://bikedataproject.github.io/heatmap-experiment/mvt.json',
                //url: 'http://localhost:8081/mvt-local.json'
            });

            map.addLayer(
                {
                    'id': 'earthquakes-heat',
                    'type': 'heatmap',
                    'source': 'earthquakes',
                    'source-layer': 'heatmap',
                    'paint': {
                        // Increase the heatmap weight based on frequency and property magnitude
                        'heatmap-weight': [
                            'interpolate',
                            ['linear'],
                            ['zoom'],
                            7,
                            ['/', ['get', 'cost'], 10000],
                            14,
                            ['/', ['get', 'cost'], 400],
                            20,
                            ['/', ['get', 'cost'], 100]
                            ],
                        // Increase the heatmap color weight weight by zoom level
                        // heatmap-intensity is a multiplier on top of heatmap-weight
                        'heatmap-intensity': [
                            'interpolate',
                            ['linear'],
                            ['zoom'],
                            0,
                            1,
                            7,
                            1,
                            20,
                            6
                        ],
                        // Color ramp for heatmap.  Domain is 0 (low) to 1 (high).
                        // Begin color ramp at 0-stop with a 0-transparancy color
                        // to create a blur-like effect.
                        // 'heatmap-color': [
                        //     'interpolate',
                        //     ['linear'],
                        //     ['heatmap-density'],
                        //     0,
                        //     'rgba(00,00,172,0)',
                        //     1,
                        //     '#ffff00'
                        //     1,
                        //     '#ffff00'
                        // ],
                        'heatmap-color': [
                            'interpolate',
                            ['linear'],
                            ['heatmap-density'],
                            0,
                            'rgba(33,102,172,0)',
                            0.2,
                            'rgb(103,169,207)',
                            0.3,
                            'rgb(255,0,0)',
                            1,
                            'rgba(255,220,75, 1)'
                        ],
                        // Adjust the heatmap radius by zoom level
                        'heatmap-radius': [
                            'interpolate',
                            ['linear'],
                            ['zoom'],
                            0,
                            2,
                            14,
                            10,
                            20,
                            40
                        ],
                        // Transition from heatmap to circle layer by zoom level
                        'heatmap-opacity': [
                            'interpolate',
                            ['linear'],
                            ['zoom'],
                            0,
                            0.8,
                            7,
                            0.7,
                            20,
                            0.7
                        ]
                    }
                }, lowestSymbol
            );
        });
    </script>

</body>

</html>
